## JWT, Json Web Token이란?

---

JWT는 일반적으로 클라이언트와 서버 사이에서 통신할 때 권한을 위해 사용하는 토큰이다.

- 웹 상에서 정보를 Json 형태로 주고 받기 위해 표준규약에 따라 생성한 암호화된 토큰이다.
- 때문에 복잡하고 읽을 수 없는 `String` 형태로 저장되어 있다.

## JWT의 구성요소

---

JWT는 `헤더(Header)`, `페이로드(Payload)`, `서명(Signature)`로, 다음과 같이 구성되어 있다.

![JWT Component](/backend_knowledge_notes/image_files/Security/jwt-component.png)

### 헤더, Header

어떠한 알고리즘으로 암호화를 할 것인지, 어떠한 토큰을 사용할 것인지에 대한 정보가 들어있다.

### 정보, Payload

전달하려는 정보 즉, 사용자 ID나 다른 데이터들이 들어있다.

- 여기서 사용자 ID 및 다른 데이터들을 클레임, Claim이라고 부른다.

페이로드에 있는 내용은 수정이 가능하여 더 많은 정보를 추가할 수 있다.

- 그러나 노출과 수정이 가능하여 인증이 필요한 최소한의 정보만을 담아야 한다.
- 여기서 최소한의 정보는 아이디, 비밀번호가 아닌 토큰의 권한이나 범위 등을 포함한다.

### 서명, Signature

헤더와 페이로드를 합쳐 발급해 준 서버가 지정한 Secret-Key로 암호화시켜 토큰을 변조하기 어렵게 만든다.

예를 들어, 토큰 발급 후 누군가 페이로드의 정보를 수정하면, 페이로드에는 조작한 정보가 들어간다.

- 하지만, 서명에는 수정되기 전의 페이로드 내용을 기반으로 이미 암호화를 진행한 결과가 저장된다.
- 때문에 누군가 조작한 페이로드의 결과값과는 다른 결과값이 나오게 된다.

따라서 서명은 서버에서 토큰이 조작되었는지 아닌지 알 수 있고, 조작을 통한 악용이 어렵다.

## JWT의 동작 과정

---

![JWT Architecture](/backend_knowledge_notes/image_files/Security/jwt-architecture.png)

1. 사용자는 ID와 Password를 입력하여 로그인 요청을 한다.
2. 서버는 회원 데이터베이스에 저장되어 있는 사용자인지 확인을 한다.
3. 확인이 되면 서버는 로그인 요청을 확인한 후, Secret-Key를 통해 토큰을 발급한다.
4. 서버는 발급한 토큰을 클라이언트에게 전달한다.
5. 사용자는 서비스 요청과 권한을 확인하기 위해서 헤더에 데이터(JWT) 요청을 한다.
6. 서버는 데이터를 확인하고 JWT에서 사용자 정보를 확인한다.
7. 서버는 클라이언트 요청에 대한 응답과 요청한 데이터를 사용자에게 전달한다.

토큰 기반 인증 방식은 사용자 인증이 완료된 후 서버에서 토큰을 발급한다.

클라이언트는 전달받은 토큰을 저장해두고 서버에 요청을 할 때마다 해당 토큰을 서버에 함께 전달한다.

그 이후에 서버는 토큰을 검증하고 응답을 하는 방식으로 동작한다.

## 일반 토큰 기반 vs 클레임 토큰 기반

---

JWT를 사용하는 가장 큰 이유는 클레임 토큰 기반 인증이 주는 편리함이 가장 크다고 할 수 있다.

기존에 사용하던 일반 토큰 기반 인증 방식은 토큰을 검증할 때 필요한 정보들을 서버에 저장하였다.

- 때문에 항상 데이터베이스에 접근을 해야 했다.
- 또한, 세션 방식도 저장소에 저장한 세션ID를 찾아 검증하는 절차로 인해 번거로움을 느꼈다.

하지만, 클레임 토큰 기반 인증 방식은 JWT에 사용자 정보를 담고 있어 별도의 저장소가 필요없다.

- 때문에 중앙 집중식 인증 서버와 데이터베이스에 의존하지 않아 쉬운 인증을 제공한다.

### 참고 자료
- [JWT란 무엇인가?](https://velog.io/@hahan/JWT%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80)
